<?xml version="1.0" encoding="UTF-8"?>
<!--

        This file is part of the Squashtest platform.
        Copyright (C) Henix, henix.fr

        See the NOTICE file distributed with this work for additional
        information regarding copyright ownership.

        This is free software: you can redistribute it and/or modify
        it under the terms of the GNU Lesser General Public License as published by
        the Free Software Foundation, either version 3 of the License, or
        (at your option) any later version.

        this software is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
        GNU Lesser General Public License for more details.

        You should have received a copy of the GNU Lesser General Public License
        along with this software.  If not, see <http://www.gnu.org/licenses/>.

-->
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">


	<changeSet id="tm-1.13.0" author="bsiri">
		<comment>Update TM database version number</comment>
		<update tableName="CORE_CONFIG">
			<column name="VALUE" value="1.13.0" />
			<where>STR_KEY = 'squashtest.tm.database.version'</where>
		</update>
	</changeSet>


	<changeSet id="tm-1.13.0-feature-5155-1" author="jsimon">
		<createTable tableName="BUGTRACKER_PROJECT">
			<column name="BUGTRACKER_PROJECT_ID" type="BIGINT"
				autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="BUGTRACKER_BINDING_ID" type="BIGINT">
				<constraints nullable="false"
					foreignKeyName="fk_bugtracker_project_bugtracker_binding"
					references="BUGTRACKER_BINDING(BUGTRACKER_BINDING_ID)" />
			</column>

			<column name="BUGTRACKER_PROJECT_NAME" type="java.sql.Types.VARCHAR(255)"></column>

			<column name="BUGTRACKER_PROJECT_ORDER" type="int">
				<constraints nullable="false" />
			</column>
		</createTable>

		<createIndex tableName="BUGTRACKER_PROJECT" indexName="idx_bugtracker_project">
			<column name="BUGTRACKER_PROJECT_ID" />
		</createIndex>



		<sql>
			insert into BUGTRACKER_PROJECT(BUGTRACKER_BINDING_ID,
			BUGTRACKER_PROJECT_NAME, BUGTRACKER_PROJECT_ORDER) select
			BUGTRACKER_BINDING_ID, PROJECT_NAME, 0 from BUGTRACKER_BINDING;
		</sql>

		<dropColumn tableName="BUGTRACKER_BINDING" columnName="PROJECT_NAME" />

	</changeSet>

	<changeSet id="tm-1.13.0-feature-5162-1" author="bsiri">
		<comment>Now campaigns and iterations have a reference too</comment>

		<addColumn tableName="CAMPAIGN">
			<column name="REFERENCE" type="java.sql.Types.VARCHAR(50)"
				defaultValue="" remarks="a reference lavel for a campaign" />
		</addColumn>

		<addColumn tableName="ITERATION">
			<column name="REFERENCE" type="java.sql.Types.VARCHAR(50)"
				defaultValue="" remarks="a reference lavel for an iteration" />
		</addColumn>

		<!-- I thought that scripting Squash TA was a bitch but wait to see this -->
		<!-- For iterations that existed prior to 1.13.0, here we assign iteration_order
			as their default reference. Luckily it seems that databases accept that you
			can affect a numeric type to a varchar column and that they coerce them implicitly.
			If a DBMS doesn't accept it, put the following instruction in a dedicated
			changeset : update ITERATION i set reference = (select CAST ( ((ci.iteration_order)
			+ 1) as varchar) from CAMPAIGN_ITERATION ci where ci.iteration_id = i.iteration_id
			); -->
		<sql>
			update ITERATION i
			set reference = (select (ci.iteration_order +
			1) from
			CAMPAIGN_ITERATION ci where ci.iteration_id = i.iteration_id
			);
		</sql>
	</changeSet>

	<changeSet id="tm-1.13.0-feature-4022-1" author="jsimon">

		<addColumn tableName="PROJECT">
			<column name="ALLOW_TC_MODIF_DURING_EXEC" type="BOOLEAN"
				defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>


	<changeSet id="tm-1.13.0-feature-5292-issues" author="bsiri">
		<comment>
			creating a view that helps querying on all the issues reported in an execution because
			querying EXECUTION and EXECUTION_STEP separately is just a pain in the ass.
		</comment>

		<createView viewName="EXECUTION_ISSUES_CLOSURE">
			select exec.execution_id, issue.issue_id
			from EXECUTION exec
			inner join ISSUE issue on exec.issue_list_id = issue.issue_list_id
			UNION
			select eesteps.execution_id, issue.issue_id
			from EXECUTION_EXECUTION_STEPS eesteps
			inner join EXECUTION_STEP estep on eesteps.execution_step_id = estep.execution_step_id
			inner join ISSUE issue on estep.issue_list_id = issue.issue_list_id
		</createView>

	</changeSet>


	<changeSet id="tm-1.13.0-feature-5375-1" author="jsimon, bsiri">

		<comment>
			The table CHART_QUERY aggregates 1..* CHART_MEASURE_COLUMN, 1..* CHART_AXIS_COLUMN and 0..* CHART_FILTER
			(see these table for more informations). It may be referenced by either a CHART_DEFINITION (as a query),
			either a COLUMN_PROTOTYPE (as a subquery).
		</comment>

		<createTable tableName="CHART_QUERY">

			<column name="CHART_QUERY_ID" type="BIGINT" autoIncrement="true" remarks="autogenerated ID">
				<constraints primaryKey="true" nullable="false"/>
			</column>

			<column name="NAME" type="VARCHAR(100)" remarks="internal usage, when this CHART_QUERY is a
			CHART_COLUMN_PROTOTYPE subquery the name helps identify which one" />

			<column name="STRATEGY" type="VARCHAR(20)" remarks="says how the query builder should integrate this query
			to a main query. Accepts values : MAIN, SUBQUERY or INLINED"/>

			<column name="JOIN_STYLE" type="VARCHAR(10)" remarks="generally indicate whether should use inner join or left join when a
			natural join is possible. Possible values : INNER_JOIN or LEFT_JOIN"/>

		</createTable>


		<comment>
			The table CHART_DEFINITION describes the custom charts created by the user. Along with
			the informations stored in this table a CHART_DEFINITION refers to a CHART_QUERY,
			which aggregates the unit blocks that constitute the data elligible for plotting.
		</comment>
		<createTable tableName="CHART_DEFINITION">

			<column name="CHART_ID" type="BIGINT" autoIncrement="true" remarks="autogenerated ID">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="USER_ID" type="BIGINT" remarks="foreign key to the owner of this chart definition">
				<constraints nullable="false" foreignKeyName="fk_chart_owner"
					references="CORE_USER(PARTY_ID)" />
			</column>

			<column name="QUERY_ID" type="BIGINT" remarks="foreign key to a CHART_QUERY">
				<constraints nullable="false" foreignKeyName="fk_chart_query" references="CHART_QUERY(CHART_QUERY_ID)"/>
			</column>

			<column name="NAME" type="java.sql.Types.VARCHAR(50)" remarks="The name of this chart"/>
			<column name="VISIBILITY" type="java.sql.Types.VARCHAR(20)" remarks="whether this chart is 'PRIVATE' or 'PUBLIC'"/>
			<column name="CHART_TYPE" type="java.sql.Types.VARCHAR(20)" remarks="whether this chart is a 'PIE', 'BAR' etc"/>
			<column name="DESCRIPTION" type="CLOB" remarks="additional informations about this chart"/>

			<column name="PROJECT_ID" type="BIGINT" remarks="cle etrangere vers le projet. ">
				<constraints nullable="false" foreignKeyName="fk_project_chart_definition_project_id" references="PROJECT(PROJECT_ID)" />
			</column>

      <column name="CREATED_BY" type="java.sql.Types.VARCHAR(50)">
        <constraints nullable="false" />
      </column>

      <column name="CREATED_ON" type="DATETIME">
        <constraints nullable="false" />
      </column>

      <column name="LAST_MODIFIED_BY" type="java.sql.Types.VARCHAR(50)" defaultValue="NULL" />
      <column name="LAST_MODIFIED_ON" type="DATETIME" defaultValue="NULL" />

		</createTable>

		<createIndex tableName="CHART_DEFINITION" indexName="idx_chart_definition">
			<column name="CHART_ID" />
		</createIndex>


		<comment>
			This table holds referential data only (users cannot populate it) :
			it lists every single columns that can be used in a custom chart.
			Here, a column is basically an attribute from an entity. Theses columns
			are merely options proposed to the user. Once the user confirmed that he
			wants to include a particular column in a custom chart, and in which
			context (as a measure, an axis or applying a filter on it), the entries
			from this table will be referenced by entries in tables FILTER,
			AXIS_COLUMN or MEASURE_COLUMN.

			Some columns aren't proper attributes of an entity but rather the result of
			an expression. This expression is itself expressed as a CHART_QUERY.
			For this reason a COLUMN_PROTOTYPE may point to a CHART_QUERY via a
			(nullable) foreign key.

			Last, some columns aren't supposed to be available to the user and used
			in a chart. The attribute 'BUSINESS' = true indicates that the user is allowed
			to use them.
		</comment>

		<createTable tableName="CHART_COLUMN_PROTOTYPE" >

			<column name="CHART_COLUMN_ID" type="BIGINT" autoIncrement="true" remarks="the column ID">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="COLUMN_TYPE" type="java.sql.Types.VARCHAR(15)"
				remarks="complementary information about the nature of this column : native attribute ('ATTRIBUTE'),
				computed field ('CALCULATED') - often as a subquery -, or custom field ('CUF')"/>

			<column name="SUBQUERY_ID" type="BIGINT" remarks="optional foreign key to a (sub) CHART_QUERY">
				<constraints nullable="true" foreignKeyName="fk_column_query" references="CHART_QUERY(CHART_QUERY_ID)"/>
			</column>

			<column name="LABEL" type="java.sql.Types.VARCHAR(255)" remarks="The default label for this column." />

			<column name="ENTITY_TYPE" type="java.sql.Types.VARCHAR(30)" remarks="The kind of entities this column belongs to"/>

			<column name="ENTITY_ROLE" type="VARCHAR(40)" remarks="a complementary qualifier for ENTITY_TYPE,
										used when an entity has an auxialiary role regarding another entity.
										For instance an InfoListItem may have a role of nature for a TestCase,
										or category for a RequirementVersion. May be null if nothing special about it."/>

			<column name="ATTRIBUTE_NAME" type="java.sql.Types.VARCHAR(255)" remarks="The name of the attribute of the entity"/>

			<column name="DATA_TYPE" type="java.sql.Types.VARCHAR(50)" remarks="Data type of the attribute"/>

			<column name="BUSINESS" type="BOOLEAN" remarks="tells whether this column is public or internal." defaultValueBoolean="true"/>
			<column name="ATTRIBUTE_TYPE" type="java.sql.Types.VARCHAR(15)"
				remarks="complementary information about the nature of this column : native attribute ('ATTRIBUTE'),
				computed field ('CALCULATED') - often as a subquery -, or custom field ('CUF')"/>

		</createTable>

		<createIndex tableName="CHART_COLUMN_PROTOTYPE" indexName="idx_column_prototype">
			<column name="CHART_COLUMN_ID" />
		</createIndex>


		<comment>
			The CHART_COLUMN_ROLES precises in which roles a particular CHART_COLUMN_PROTOTYPE can
			be used : 'AXIS', 'FILTER' or 'MEASURE'.
		</comment>
		<createTable tableName="CHART_COLUMN_ROLE">

			<column name="CHART_COLUMN_ID" type="BIGINT" remarks="foreign key to CHART_COLUMN_PROTOTYPE">
				<constraints nullable="false" foreignKeyName="fk_column_role_chart_column"
					references="CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID)" />
			</column>

			<column name="ROLE" type="java.sql.Types.VARCHAR(255)" remarks="name of a role for the referenced column"></column>
		</createTable>



		<comment>
			This table store which columns are the measures the user is interested to see.
			They consists of an aggregation operation applied to a CHART_COLUMN_PROTOTYPE.
		</comment>
		<createTable tableName="CHART_MEASURE_COLUMN">

			<column name="CHART_COLUMN_ID" type="BIGINT" remarks="foreign key to the CHART_COLUMN_PROTOTYPE this measure applies to">
				<constraints nullable="false" foreignKeyName="fk_chart_measure_chart_column"
					references="CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID)" />
			</column>

			<column name="QUERY_ID" type="BIGINT" remarks="foreign key to a CHART_QUERY">
				<constraints nullable="false"
					foreignKeyName="fk_chart_measure_chart_query" references="CHART_QUERY(CHART_QUERY_ID)" />
			</column>

			<column name="LABEL" type="java.sql.Types.VARCHAR(30)"
				remarks="a label for this measure. Will override the default label of the column prototype if non null."/>

			<column name="MEASURE_OPERATION" type="java.sql.Types.VARCHAR(20)" remarks="the measure applied to the column"/>

			<column name="MEASURE_RANK" type="java.sql.Types.INTEGER"
				remarks="the order in which the measure will be displayed when the chart is rendered."/>

		</createTable>


		<comment>
			A CHART_FILTER restricts the values a CHART_COLUMN_PROTOTYPE may have for a given chart.
			A CHART_FILTER will compare the value of a CHART_COLUMN_PROTOTYPE with one or several
			CHART_FILTER_VALUES using a comparison operator.
		</comment>
		<createTable tableName="CHART_FILTER">
			<column name="FILTER_ID" type="BIGINT" autoIncrement="true" remarks="autogenerated ID">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="CHART_COLUMN_ID" type="BIGINT" remarks="foreign key to a CHART_COLUMN_PROTOTYPE">
				<constraints nullable="false" foreignKeyName="fk_chart_filter_chart_column"
					references="CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID)" />
			</column>

			<column name="QUERY_ID" type="BIGINT" remarks="foreign key to a CHART_QUERY">
				<constraints nullable="false"
					foreignKeyName="fk_chart_FILTER_chart_query" references="CHART_QUERY(CHART_QUERY_ID)" />
			</column>

			<column name="FILTER_OPERATION" type="java.sql.Types.VARCHAR(20)" remarks="a comparison operator"/>

		</createTable>

		<createIndex tableName="CHART_FILTER" indexName="idx_chart_filter">
			<column name="FILTER_ID" />
		</createIndex>


		<comment>
			This table holds the values used in a CHART_FILTER.
		</comment>
		<createTable tableName="CHART_FILTER_VALUES">

			<column name="FILTER_ID" type="BIGINT" remarks="foreign key to CHART_FILTER" >
				<constraints nullable="false"
					foreignKeyName="fk_chart_filter_value_chart_column" references="CHART_FILTER(FILTER_ID)" />
			</column>

			<column name="FILTER_VALUE" type="java.sql.Types.VARCHAR(255)" remarks="a value for this filter"/>

		</createTable>


		<comment>
			This table holds which CHART_COLUMN_PROTOTYPE are the axes for a given chart.
		</comment>
		<createTable tableName="CHART_AXIS_COLUMN">

			<column name="CHART_COLUMN_ID" type="BIGINT" remarks="foreign key to CHART_COLUMN_PROTOTYPE">
				<constraints nullable="false" foreignKeyName="fk_axis_column_chart_column"
					references="CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID)" />
			</column>

			<column name="QUERY_ID" type="BIGINT" remarks="foreign key to a CHART_QUERY">
				<constraints nullable="false"
					foreignKeyName="fk_chart_axis_chart_query" references="CHART_QUERY(CHART_QUERY_ID)" />
			</column>

			<column name="LABEL" type="java.sql.Types.VARCHAR(100)"
				remarks="a label for this axis. If non null, will override the default label in the CHART_COLUMN_PROTOTYPE"/>

			<column name="AXIS_OPERATION" type="java.sql.Types.VARCHAR(20)"
				remarks="may define an additional operation about how data are grouped on this axis, most of the time 'NONE' is fine, however
				for Timestamp columns an adequate aggregation (day, month etc) may be useful"/>

			<column name="AXIS_RANK" type="java.sql.Types.INTEGER" remarks="in which order the axis are processed (if relevant)"/>

		</createTable>


		<comment>
			The scope is a particular filter on the data : it restrict the perimeter from which the measured entities can be chosen,
			for example from project X and folder Y
		</comment>
		<createTable tableName="CHART_SCOPE">

			<column name="CHART_ID" type="BIGINT" remarks="foreign key to a CHART_DEFINITION">
				<constraints nullable="false" foreignKeyName="fk_chart_scope_chart_definition"
					references="CHART_DEFINITION(CHART_ID)" />
			</column>

			<column name="ENTITY_REFERENCE_TYPE" type="java.sql.Types.VARCHAR(50)" remarks="the type of the referenced entity"/>
			<column name="ENTITY_REFERENCE_ID" type="java.sql.Types.INTEGER" remarks="the id of the referenced entity"/>

		</createTable>

	</changeSet>


	<changeSet id="tm-1.13.0-feature-5375-2" author="bsiri">

		<comment>populate the column prototype referential data (generated from src/main/script/MakeChartColumns.groovy)</comment>

		<sql>

		-- --------------------------------------------
		-- Chart Column Prototype Definition --
		--
		-- generated by src/main/script/MakeChartColumns.groovy
		-- --------------------------------------------
		
		-- -------------------------------------------
		-- section 1 :  basic attribute columns
		-- -------------------------------------------
		
		
		-- columns for entity : REQUIREMENT --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(1, 'ATTRIBUTE', TRUE, 'REQUIREMENT_ID', 'REQUIREMENT', null, 'NUMERIC', 'id', null),
			(3, 'ATTRIBUTE', FALSE, 'REQUIREMENT_PROJECT', 'REQUIREMENT', null, 'NUMERIC', 'project.id', null),
			(4, 'ATTRIBUTE', TRUE, 'REQUIREMENT_CRITICALITY', 'REQUIREMENT', null, 'LEVEL_ENUM', 'resource.criticality', null),
			(5, 'ATTRIBUTE', TRUE, 'REQUIREMENT_STATUS', 'REQUIREMENT', null, 'LEVEL_ENUM', 'resource.status', null),
			(6, 'ATTRIBUTE', TRUE, 'REQUIREMENT_CATEGORY', 'REQUIREMENT', null, 'INFO_LIST_ITEM', 'resource.category.code', null);
		
		insert into CHART_COLUMN_ROLE(CHART_COLUMN_ID, ROLE)
		values
			 (1, 'MEASURE'), (1, 'AXIS'), (1, 'FILTER'),
			 (4, 'MEASURE'), (4, 'AXIS'), (4, 'FILTER'),
			 (5, 'MEASURE'), (5, 'AXIS'), (5, 'FILTER'),
			 (6, 'MEASURE'), (6, 'AXIS'), (6, 'FILTER');
		
		
		
		
		-- columns for entity : REQUIREMENT_VERSION --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(7, 'ATTRIBUTE', TRUE, 'REQUIREMENT_VERSION_ID', 'REQUIREMENT_VERSION', null, 'NUMERIC', 'id', null),
			(8, 'ATTRIBUTE', TRUE, 'REQUIREMENT_VERSION_REFERENCE', 'REQUIREMENT_VERSION', null, 'STRING', 'reference', null),
			(9, 'ATTRIBUTE', TRUE, 'REQUIREMENT_VERSION_CATEGORY', 'REQUIREMENT_VERSION', null, 'INFO_LIST_ITEM', 'category.code', null),
			(10, 'ATTRIBUTE', TRUE, 'REQUIREMENT_VERSION_CRITICALITY', 'REQUIREMENT_VERSION', null, 'LEVEL_ENUM', 'criticality', null),
			(11, 'ATTRIBUTE', TRUE, 'REQUIREMENT_VERSION_STATUS', 'REQUIREMENT_VERSION', null, 'LEVEL_ENUM', 'status', null),
			(12, 'ATTRIBUTE', TRUE, 'REQUIREMENT_VERSION_CREATED_BY', 'REQUIREMENT_VERSION', null, 'STRING', 'audit.createdBy', null),
			(13, 'ATTRIBUTE', TRUE, 'REQUIREMENT_VERSION_CREATED_ON', 'REQUIREMENT_VERSION', null, 'DATE', 'audit.createdOn', null),
			(14, 'ATTRIBUTE', TRUE, 'REQUIREMENT_VERSION_MODIFIED_BY', 'REQUIREMENT_VERSION', null, 'STRING', 'audit.lastModifiedBy', null),
			(15, 'ATTRIBUTE', TRUE, 'REQUIREMENT_VERSION_MODIFIED_ON', 'REQUIREMENT_VERSION', null, 'DATE', 'audit.lastModifiedOn', null),
			(16, 'ATTRIBUTE', TRUE, 'REQUIREMENT_VERSION_VERS_NUM', 'REQUIREMENT_VERSION', null, 'NUMERIC', 'versionNumber', null);
		
		insert into CHART_COLUMN_ROLE(CHART_COLUMN_ID, ROLE)
		values
			 (7, 'MEASURE'), (7, 'AXIS'), (7, 'FILTER'),
			 (8, 'FILTER'), (8, 'AXIS'),
			 (9, 'MEASURE'), (9, 'AXIS'), (9, 'FILTER'),
			 (10, 'MEASURE'), (10, 'AXIS'), (10, 'FILTER'),
			 (11, 'MEASURE'), (11, 'AXIS'), (11, 'FILTER'),
			 (12, 'AXIS'), (12, 'FILTER'),
			 (13, 'AXIS'), (13, 'FILTER'),
			 (14, 'AXIS'), (14, 'FILTER'),
			 (15, 'AXIS'), (15, 'FILTER'),
			 (16, 'FILTER'), (16, 'MEASURE');
		
		
		
		
		-- columns for entity : TEST_CASE --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(19, 'ATTRIBUTE', TRUE, 'TEST_CASE_ID', 'TEST_CASE', null, 'NUMERIC', 'id', null),
			(20, 'ATTRIBUTE', TRUE, 'TEST_CASE_REFERENCE', 'TEST_CASE', null, 'STRING', 'reference', null),
			(21, 'ATTRIBUTE', TRUE, 'TEST_CASE_IMPORTANCE', 'TEST_CASE', null, 'LEVEL_ENUM', 'importance', null),
			(22, 'ATTRIBUTE', TRUE, 'TEST_CASE_NATURE', 'TEST_CASE', null, 'INFO_LIST_ITEM', 'nature.code', null),
			(23, 'ATTRIBUTE', TRUE, 'TEST_CASE_TYPE', 'TEST_CASE', null, 'INFO_LIST_ITEM', 'type.code', null),
			(24, 'ATTRIBUTE', TRUE, 'TEST_CASE_STATUS', 'TEST_CASE', null, 'LEVEL_ENUM', 'status', null),
			(25, 'ATTRIBUTE', TRUE, 'TEST_CASE_CREATED_BY', 'TEST_CASE', null, 'STRING', 'audit.createdBy', null),
			(26, 'ATTRIBUTE', TRUE, 'TEST_CASE_CREATED_ON', 'TEST_CASE', null, 'DATE', 'audit.createdOn', null),
			(27, 'ATTRIBUTE', TRUE, 'TEST_CASE_MODIFIED_BY', 'TEST_CASE', null, 'STRING', 'audit.lastModifiedBy', null),
			(28, 'ATTRIBUTE', TRUE, 'TEST_CASE_MODIFIED_ON', 'TEST_CASE', null, 'DATE', 'audit.lastModifiedOn', null),
			(29, 'ATTRIBUTE', FALSE, 'TEST_CASE_PROJECT', 'TEST_CASE', null, 'NUMERIC', 'project.id', null);
		
		insert into CHART_COLUMN_ROLE(CHART_COLUMN_ID, ROLE)
		values
			 (19, 'MEASURE'), (19, 'AXIS'), (19, 'FILTER'),
			 (20, 'FILTER'), (20, 'AXIS'),
			 (21, 'MEASURE'), (21, 'AXIS'), (21, 'FILTER'),
			 (22, 'MEASURE'), (22, 'AXIS'), (22, 'FILTER'),
			 (23, 'MEASURE'), (23, 'AXIS'), (23, 'FILTER'),
			 (24, 'MEASURE'), (24, 'AXIS'), (24, 'FILTER'),
			 (25, 'AXIS'), (25, 'FILTER'),
			 (26, 'AXIS'), (26, 'FILTER'),
			 (27, 'AXIS'), (27, 'FILTER'),
			 (28, 'AXIS'), (28, 'FILTER');
		
		
		
		
		-- columns for entity : CAMPAIGN --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(37, 'ATTRIBUTE', TRUE, 'CAMPAIGN_ID', 'CAMPAIGN', null, 'NUMERIC', 'id', null),
			(38, 'ATTRIBUTE', FALSE, 'CAMPAIGN_PROJECT', 'CAMPAIGN', null, 'NUMERIC', 'project.id', null),
			(39, 'ATTRIBUTE', TRUE, 'CAMPAIGN_REFERENCE', 'CAMPAIGN', null, 'STRING', 'reference', null),
			(40, 'ATTRIBUTE', TRUE, 'CAMPAIGN_SCHED_START', 'CAMPAIGN', null, 'DATE', 'scheduledPeriod.scheduledStartDate', null),
			(41, 'ATTRIBUTE', TRUE, 'CAMPAIGN_SCHED_END', 'CAMPAIGN', null, 'DATE', 'scheduledPeriod.scheduledEndDate', null),
			(42, 'ATTRIBUTE', TRUE, 'CAMPAIGN_ACTUAL_START', 'CAMPAIGN', null, 'DATE', 'actualPeriod.actualStartDate', null),
			(43, 'ATTRIBUTE', TRUE, 'CAMPAIGN_ACTUAL_END', 'CAMPAIGN', null, 'DATE', 'actualPeriod.actualEndDate', null);
		
		insert into CHART_COLUMN_ROLE(CHART_COLUMN_ID, ROLE)
		values
			 (37, 'MEASURE'), (37, 'AXIS'), (37, 'FILTER'),
			 (39, 'FILTER'), (39, 'MEASURE'),
			 (40, 'AXIS'), (40, 'FILTER'),
			 (41, 'AXIS'), (41, 'FILTER'),
			 (42, 'AXIS'), (42, 'FILTER'),
			 (43, 'AXIS'), (43, 'FILTER');
		
		
		
		
		-- columns for entity : ITERATION --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(46, 'ATTRIBUTE', TRUE, 'ITERATION_ID', 'ITERATION', null, 'NUMERIC', 'id', null),
			(47, 'ATTRIBUTE', TRUE, 'ITERATION_REFERENCE', 'ITERATION', null, 'STRING', 'reference', null),
			(48, 'ATTRIBUTE', TRUE, 'ITERATION_SCHED_START', 'ITERATION', null, 'DATE', 'scheduledPeriod.scheduledStartDate', null),
			(49, 'ATTRIBUTE', TRUE, 'ITERATION_SCHED_END', 'ITERATION', null, 'DATE', 'scheduledPeriod.scheduledEndDate', null),
			(50, 'ATTRIBUTE', TRUE, 'ITERATION_ACTUAL_START', 'ITERATION', null, 'DATE', 'actualPeriod.actualStartDate', null),
			(51, 'ATTRIBUTE', TRUE, 'ITERATION_ACTUAL_END', 'ITERATION', null, 'DATE', 'actualPeriod.actualEndDate', null);
		
		insert into CHART_COLUMN_ROLE(CHART_COLUMN_ID, ROLE)
		values
			 (46, 'MEASURE'), (46, 'AXIS'), (46, 'FILTER'),
			 (47, 'FILTER'), (47, 'MEASURE'),
			 (48, 'AXIS'), (48, 'FILTER'),
			 (49, 'AXIS'), (49, 'FILTER'),
			 (50, 'AXIS'), (50, 'FILTER'),
			 (51, 'AXIS'), (51, 'FILTER');
		
		
		
		
		-- columns for entity : ITEM_TEST_PLAN --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(54, 'ATTRIBUTE', TRUE, 'ITEM_TEST_PLAN_ID', 'ITEM_TEST_PLAN', null, 'NUMERIC', 'id', null),
			(55, 'ATTRIBUTE', TRUE, 'ITEM_TEST_PLAN_LABEL', 'ITEM_TEST_PLAN', null, 'STRING', 'label', null),
			(56, 'ATTRIBUTE', TRUE, 'ITEM_TEST_PLAN_STATUS', 'ITEM_TEST_PLAN', null, 'EXECUTION_STATUS', 'executionStatus', null),
			(57, 'ATTRIBUTE', TRUE, 'ITEM_TEST_PLAN_LASTEXECON', 'ITEM_TEST_PLAN', null, 'DATE', 'lastExecutedOn', null),
			(58, 'ATTRIBUTE', TRUE, 'ITEM_TEST_PLAN_DATASET_LABEL', 'ITEM_TEST_PLAN', null, 'STRING', 'referencedDataset.name', null),
			(59, 'ATTRIBUTE', TRUE, 'ITEM_TEST_PLAN_TESTER', 'ITEM_TEST_PLAN', null, 'STRING', 'user.login', null),
			(60, 'ATTRIBUTE', TRUE, 'ITEM_TEST_PLAN_TC_ID', 'ITEM_TEST_PLAN', null, 'NUMERIC', 'referencedTestCase.id', null);
		
		insert into CHART_COLUMN_ROLE(CHART_COLUMN_ID, ROLE)
		values
			 (54, 'MEASURE'), (54, 'AXIS'), (54, 'FILTER'),
			 (55, 'MEASURE'), (55, 'AXIS'), (55, 'FILTER'),
			 (56, 'MEASURE'), (56, 'AXIS'), (56, 'FILTER'),
			 (57, 'MEASURE'), (57, 'AXIS'), (57, 'FILTER'),
			 (58, 'MEASURE'), (58, 'AXIS'), (58, 'FILTER'),
			 (59, 'MEASURE'), (59, 'AXIS'), (59, 'FILTER'),
			 (60, 'MEASURE'), (60, 'AXIS'), (60, 'FILTER');
		
		
		
		
		-- columns for entity : EXECUTION --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(66, 'ATTRIBUTE', TRUE, 'EXECUTION_ID', 'EXECUTION', null, 'NUMERIC', 'id', null),
			(67, 'ATTRIBUTE', TRUE, 'EXECUTION_LABEL', 'EXECUTION', null, 'STRING', 'name', null),
			(68, 'ATTRIBUTE', TRUE, 'EXECUTION_DS_LABEL', 'EXECUTION', null, 'STRING', 'datasetLabel', null),
			(69, 'ATTRIBUTE', TRUE, 'EXECUTION_LASTEXEC', 'EXECUTION', null, 'DATE', 'lastExecutedOn', null),
			(70, 'ATTRIBUTE', TRUE, 'EXECUTION_TESTER_LOGIN', 'EXECUTION', null, 'STRING', 'lastExecutedBy', null),
			(71, 'ATTRIBUTE', TRUE, 'EXECUTION_STATUS', 'EXECUTION', null, 'EXECUTION_STATUS', 'executionStatus', null);
		
		insert into CHART_COLUMN_ROLE(CHART_COLUMN_ID, ROLE)
		values
			 (66, 'MEASURE'), (66, 'AXIS'), (66, 'FILTER'),
			 (67, 'AXIS'), (67, 'FILTER'),
			 (68, 'AXIS'), (68, 'FILTER'),
			 (69, 'AXIS'), (69, 'FILTER'),
			 (70, 'AXIS'), (70, 'FILTER'),
			 (71, 'MEASURE'), (71, 'AXIS'), (71, 'FILTER');
		
		
		
		
		-- columns for entity : ISSUE --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(74, 'ATTRIBUTE', FALSE, 'ISSUE_ID', 'ISSUE', null, 'NUMERIC', 'id', null),
			(75, 'ATTRIBUTE', FALSE, 'ISSUE_REMOTE_ID', 'ISSUE', null, 'STRING', 'remoteIssueId', null),
			(76, 'ATTRIBUTE', FALSE, 'ISSUE_STATUS', 'ISSUE', null, 'STRING', 'status', null),
			(77, 'ATTRIBUTE', FALSE, 'ISSUE_SEVERITY', 'ISSUE', null, 'STRING', 'severity', null),
			(78, 'ATTRIBUTE', FALSE, 'ISSUE_BUGTRACKER', 'ISSUE', null, 'STRING', 'bugtracker', null);
		
		
		
		
		-- columns for entity : TEST_CASE_STEP --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(79, 'ATTRIBUTE', FALSE, 'TEST_CASE_STEP_ID', 'TEST_CASE_STEP', null, 'NUMERIC', 'id', null),
			(80, 'ATTRIBUTE', FALSE, 'TEST_CASE_STEP_CLASS', 'TEST_CASE_STEP', null, 'NUMERIC', 'class', null);
		
		
		
		
		-- columns for entity : TEST_CASE_NATURE --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(81, 'ATTRIBUTE', FALSE, 'TEST_CASE_NATURE_ID', 'INFO_LIST_ITEM', 'TEST_CASE_NATURE', 'NUMERIC', 'id', null),
			(82, 'ATTRIBUTE', FALSE, 'TEST_CASE_NATURE_LABEL', 'INFO_LIST_ITEM', 'TEST_CASE_NATURE', 'STRING', 'label', null);
		
		
		
		
		-- columns for entity : TEST_CASE_TYPE --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(83, 'ATTRIBUTE', FALSE, 'TEST_CASE_TYPE_ID', 'INFO_LIST_ITEM', 'TEST_CASE_TYPE', 'NUMERIC', 'id', null),
			(84, 'ATTRIBUTE', FALSE, 'TEST_CASE_TYPE_LABEL', 'INFO_LIST_ITEM', 'TEST_CASE_TYPE', 'STRING', 'label', null);
		
		
		
		
		-- columns for entity : REQUIREMENT_VERSION_CATEGORY --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(85, 'ATTRIBUTE', FALSE, 'REQUIREMENT_VERSION_CATEGORY_ID', 'INFO_LIST_ITEM', 'REQUIREMENT_VERSION_CATEGORY', 'NUMERIC', 'id', null),
			(86, 'ATTRIBUTE', FALSE, 'REQUIREMENT_VERSION_CATEGORY_LABEL', 'INFO_LIST_ITEM', 'REQUIREMENT_VERSION_CATEGORY', 'STRING', 'label', null);
		
		
		
		
		-- columns for entity : TEST_CASE_MILESTONE --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(87, 'ATTRIBUTE', FALSE, 'TEST_CASE_MILESTONE_ID', 'MILESTONE', 'TEST_CASE_MILESTONE', 'NUMERIC', 'id', null),
			(88, 'ATTRIBUTE', FALSE, 'TEST_CASE_MILESTONE_LABEL', 'MILESTONE', 'TEST_CASE_MILESTONE', 'STRING', 'label', null);
		
		
		
		
		-- columns for entity : REQUIREMENT_VERSION_MILESTONE --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(89, 'ATTRIBUTE', FALSE, 'REQUIREMENT_VERSION_MILESTONE_ID', 'MILESTONE', 'REQUIREMENT_VERSION_MILESTONE', 'NUMERIC', 'id', null),
			(90, 'ATTRIBUTE', FALSE, 'REQUIREMENT_VERSION_MILESTONE_LABEL', 'MILESTONE', 'REQUIREMENT_VERSION_MILESTONE', 'STRING', 'label', null);
		
		
		
		
		-- columns for entity : ITERATION_TEST_PLAN_ASSIGNED_USER --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(91, 'ATTRIBUTE', FALSE, 'ITERATION_TEST_PLAN_ASSIGNED_USER_ID', 'USER', 'ITERATION_TEST_PLAN_ASSIGNED_USER', 'NUMERIC', 'id', null),
			(92, 'ATTRIBUTE', FALSE, 'ITERATION_TEST_PLAN_ASSIGNED_USER_LOGIN', 'USER', 'ITERATION_TEST_PLAN_ASSIGNED_USER', 'STRING', 'login', null);
		
		
		
		
		-- columns for entity : AUTOMATED_TEST --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(93, 'ATTRIBUTE', FALSE, 'AUTOMATED_TEST_ID', 'AUTOMATED_TEST', null, 'NUMERIC', 'id', null);
		
		
		
		
		-- columns for entity : AUTOMATED_EXECUTION_EXTENDER --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(94, 'ATTRIBUTE', FALSE, 'AUTOMATED_EXECUTION_EXTENDER_ID', 'AUTOMATED_EXECUTION_EXTENDER', null, 'NUMERIC', 'id', null);
		
		
		
		
		-- -------------------------------------------
		-- section 2 :  subqueries
		-- -------------------------------------------
		
		-- subqueries for entity REQUIREMENT --
		
		-- subquery reqVCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (1, 'REQUIREMENT_NB_VERSIONS_SUBQUERY', 'SUBQUERY', 'INNER_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (7, 1, 'COUNT', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (1, 1, 'NONE', 0);
		
		
		
		-- subqueries for entity REQUIREMENT_VERSION --
		
		-- subquery rvVerifTCCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (2, 'REQUIREMENT_VERSION_TCCOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (19, 2, 'COUNT', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (7, 2, 'NONE', 0);
		
		
		
		-- subquery rvMilesCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (3, 'REQUIREMENT_VERSION_MILCOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (89, 3, 'COUNT', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (7, 3, 'NONE', 0);
		
		
		
		-- subqueries for entity TEST_CASE --
		
		-- subquery tcVerifVersionCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (4, 'TEST_CASE_VERSCOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (7, 4, 'COUNT', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (19, 4, 'NONE', 0);
		
		
		
		-- subquery tcCallStepsCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (5, 'TEST_CASE_CALLSTEPCOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (79, 5, 'COUNT', 0);
		insert into CHART_FILTER(FILTER_ID, CHART_COLUMN_ID, QUERY_ID, FILTER_OPERATION) values (1, 80, 5, 'EQUALS');
		insert into CHART_FILTER_VALUES(FILTER_ID, FILTER_VALUE)
		values 
			(1,'2');
		
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (19, 5, 'NONE', 0);
		
		
		
		-- subquery tcStepsCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (6, 'TEST_CASE_STEPCOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (79, 6, 'COUNT', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (19, 6, 'NONE', 0);
		
		
		
		-- subquery tcMilesCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (7, 'TEST_CASE_VERSION_MILCOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (87, 7, 'COUNT', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (19, 7, 'NONE', 0);
		
		
		
		-- subquery tcIterCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (8, 'TEST_CASE_ITERCOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (46, 8, 'COUNT', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (19, 8, 'NONE', 0);
		
		
		
		-- subquery tcExeCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (9, 'TEST_CASE_EXECOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (66, 9, 'COUNT', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (19, 9, 'NONE', 0);
		
		
		
		-- subquery tcHasAutoSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (10, 'TEST_CASE_HASAUTOSCRIPT_SUBQUERY', 'INLINED', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (93, 10, 'NOT_NULL', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (19, 10, 'NONE', 0);
		
		
		
		-- subqueries for entity CAMPAIGN --
		
		-- subquery cIterCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (11, 'CAMPAIGN_ITERCOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (46, 11, 'COUNT', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (37, 11, 'NONE', 0);
		
		
		
		-- subquery cIssueCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (12, 'CAMPAIGN_ISSUECOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (75, 12, 'COUNT', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (37, 12, 'NONE', 0);
		
		
		
		-- subqueries for entity ITERATION --
		
		-- subquery itItemCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (13, 'ITERATION_ITEMCOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (54, 13, 'COUNT', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (46, 13, 'NONE', 0);
		
		
		
		-- subquery itIssueCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (14, 'ITERATION_ISSUECOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (75, 14, 'COUNT', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (46, 14, 'NONE', 0);
		
		
		
		-- subqueries for entity ITEM_TEST_PLAN --
		
		-- subquery itpTcDeletedSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (15, 'ITEM_TEST_PLAN_TCDELETED_SUBQUERY', 'INLINED', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (19, 15, 'IS_NULL', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (54, 15, 'NONE', 0);
		
		
		
		-- subquery itpIsExecutedSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (16, 'ITEM_TEST_PLAN_ISEXECUTED_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (66, 16, 'NOT_NULL', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (54, 16, 'NONE', 0);
		
		
		
		-- subquery itpManExCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (17, 'ITEM_TEST_PLAN_MANEXCOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (66, 17, 'COUNT', 0);
		insert into CHART_FILTER(FILTER_ID, CHART_COLUMN_ID, QUERY_ID, FILTER_OPERATION) values (2, 94, 17, 'NOT_NULL');
		insert into CHART_FILTER_VALUES(FILTER_ID, FILTER_VALUE)
		values 
			(2,'FALSE');
		
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (54, 17, 'NONE', 0);
		
		
		
		-- subquery itpAutoExCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (18, 'ITEM_TEST_PLAN_AUTOEXCOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (66, 18, 'COUNT', 0);
		insert into CHART_FILTER(FILTER_ID, CHART_COLUMN_ID, QUERY_ID, FILTER_OPERATION) values (3, 94, 18, 'NOT_NULL');
		insert into CHART_FILTER_VALUES(FILTER_ID, FILTER_VALUE)
		values 
			(3,'TRUE');
		
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (54, 18, 'NONE', 0);
		
		
		
		-- subquery itpIssueCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (19, 'ITEM_TEST_PLAN_ISSUECOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (75, 19, 'COUNT', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (54, 19, 'NONE', 0);
		
		
		
		-- subqueries for entity EXECUTION --
		
		-- subquery exIsAutoSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (20, 'EXECUTION_ISAUTO_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (94, 20, 'NOT_NULL', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (66, 20, 'NONE', 0);
		
		
		
		-- subquery exIssueCountSub --
		
		insert into CHART_QUERY(CHART_QUERY_ID, NAME, STRATEGY, JOIN_STYLE) values (21, 'EXECUTION_ISSUECOUNT_SUBQUERY', 'SUBQUERY', 'LEFT_JOIN');
		insert into CHART_MEASURE_COLUMN(CHART_COLUMN_ID, QUERY_ID, MEASURE_OPERATION, MEASURE_RANK) values (75, 21, 'COUNT', 0);
		insert into CHART_AXIS_COLUMN(CHART_COLUMN_ID, QUERY_ID, AXIS_OPERATION, AXIS_RANK)  values (66, 21, 'NONE', 0);
		
		
		
		-- subqueries for entity ISSUE --
		
		-- subqueries for entity TEST_CASE_STEP --
		
		-- subqueries for entity TEST_CASE_NATURE --
		
		-- subqueries for entity TEST_CASE_TYPE --
		
		-- subqueries for entity REQUIREMENT_VERSION_CATEGORY --
		
		-- subqueries for entity TEST_CASE_MILESTONE --
		
		-- subqueries for entity REQUIREMENT_VERSION_MILESTONE --
		
		-- subqueries for entity ITERATION_TEST_PLAN_ASSIGNED_USER --
		
		-- subqueries for entity AUTOMATED_TEST --
		
		-- subqueries for entity AUTOMATED_EXECUTION_EXTENDER --
		
		
		-- -------------------------------------------
		-- section 3 :  calculated columns
		-- -------------------------------------------
		
		
		-- columns for entity : REQUIREMENT --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(2, 'CALCULATED', TRUE, 'REQUIREMENT_NB_VERSIONS', 'REQUIREMENT', null, 'NUMERIC', 'count(requirementVersionCoverages)', 1);
		
		insert into CHART_COLUMN_ROLE(CHART_COLUMN_ID, ROLE)
		values
			 (2, 'MEASURE'), (2, 'AXIS'), (2, 'FILTER');
		
		
		
		
		-- columns for entity : REQUIREMENT_VERSION --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(17, 'CALCULATED', TRUE, 'REQUIREMENT_VERSION_TCCOUNT', 'REQUIREMENT_VERSION', null, 'NUMERIC', 'count(requirementVersionCoverages)', 2),
			(18, 'CALCULATED', TRUE, 'REQUIREMENT_VERSION_MILCOUNT', 'REQUIREMENT_VERSION', null, 'NUMERIC', 'count(milestones)', 3);
		
		insert into CHART_COLUMN_ROLE(CHART_COLUMN_ID, ROLE)
		values
			 (17, 'MEASURE'), (17, 'AXIS'), (17, 'FILTER'),
			 (18, 'MEASURE'), (18, 'AXIS'), (18, 'FILTER');
		
		
		
		
		-- columns for entity : TEST_CASE --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(30, 'CALCULATED', TRUE, 'TEST_CASE_VERSCOUNT', 'TEST_CASE', null, 'NUMERIC', 'count(requirementVersionCoverages)', 4),
			(31, 'CALCULATED', TRUE, 'TEST_CASE_CALLSTEPCOUNT', 'TEST_CASE', null, 'NUMERIC', 'count(steps[class="CallTestStep"])', 5),
			(32, 'CALCULATED', TRUE, 'TEST_CASE_STEPCOUNT', 'TEST_CASE', null, 'NUMERIC', 'count(steps)', 6),
			(33, 'CALCULATED', TRUE, 'TEST_CASE_MILCOUNT', 'TEST_CASE', null, 'NUMERIC', 'count(milestones)', 7),
			(34, 'CALCULATED', TRUE, 'TEST_CASE_ITERCOUNT', 'TEST_CASE', null, 'NUMERIC', 'count(iterations)', 8),
			(35, 'CALCULATED', TRUE, 'TEST_CASE_EXECOUNT', 'TEST_CASE', null, 'NUMERIC', 'count(executions)', 9),
			(36, 'CALCULATED', TRUE, 'TEST_CASE_HASAUTOSCRIPT', 'TEST_CASE', null, 'BOOLEAN', 'notnull(automatedTest)', 10);
		
		insert into CHART_COLUMN_ROLE(CHART_COLUMN_ID, ROLE)
		values
			 (30, 'MEASURE'), (30, 'AXIS'), (30, 'FILTER'),
			 (31, 'MEASURE'), (31, 'AXIS'), (31, 'FILTER'),
			 (32, 'MEASURE'), (32, 'AXIS'), (32, 'FILTER'),
			 (33, 'MEASURE'), (33, 'AXIS'), (33, 'FILTER'),
			 (34, 'MEASURE'), (34, 'AXIS'), (34, 'FILTER'),
			 (35, 'MEASURE'), (35, 'AXIS'), (35, 'FILTER'),
			 (36, 'MEASURE'), (36, 'AXIS'), (36, 'FILTER');
		
		
		
		
		-- columns for entity : CAMPAIGN --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(44, 'CALCULATED', TRUE, 'CAMPAIGN_ITERCOUNT', 'CAMPAIGN', null, 'NUMERIC', 'count(iterations)', 11),
			(45, 'CALCULATED', TRUE, 'CAMPAIGN_ISSUECOUNT', 'CAMPAIGN', null, 'NUMERIC', 'count(issues)', 12);
		
		insert into CHART_COLUMN_ROLE(CHART_COLUMN_ID, ROLE)
		values
			 (44, 'MEASURE'), (44, 'AXIS'), (44, 'FILTER'),
			 (45, 'MEASURE'), (45, 'AXIS'), (45, 'FILTER');
		
		
		
		
		-- columns for entity : ITERATION --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(52, 'CALCULATED', TRUE, 'ITERATION_ITEMCOUNT', 'ITERATION', null, 'NUMERIC', 'count(testPlans)', 13),
			(53, 'CALCULATED', TRUE, 'ITERATION_ISSUECOUNT', 'ITERATION', null, 'NUMERIC', 'count(issues)', 14);
		
		insert into CHART_COLUMN_ROLE(CHART_COLUMN_ID, ROLE)
		values
			 (52, 'MEASURE'), (52, 'AXIS'), (52, 'FILTER'),
			 (53, 'MEASURE'), (53, 'AXIS'), (53, 'FILTER');
		
		
		
		
		-- columns for entity : ITEM_TEST_PLAN --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(61, 'CALCULATED', TRUE, 'ITEM_TEST_PLAN_TC_DELETED', 'ITEM_TEST_PLAN', null, 'BOOLEAN', 'isnull(referencedTestCase)', 15),
			(62, 'CALCULATED', TRUE, 'ITEM_TEST_PLAN_IS_EXECUTED', 'ITEM_TEST_PLAN', null, 'BOOLEAN', 'notnull(executions)', 16),
			(63, 'CALCULATED', TRUE, 'ITEM_TEST_PLAN_MANEXCOUNT', 'ITEM_TEST_PLAN', null, 'NUMERIC', 'count(executions[auto="false"])', 17),
			(64, 'CALCULATED', TRUE, 'ITEM_TEST_PLAN_AUTOEXCOUNT', 'ITEM_TEST_PLAN', null, 'NUMERIC', 'count(executions[auto="true"])', 18),
			(65, 'CALCULATED', TRUE, 'ITEM_TEST_PLAN_ISSUECOUNT', 'ITEM_TEST_PLAN', null, 'NUMERIC', 'count(issues)', 19);
		
		insert into CHART_COLUMN_ROLE(CHART_COLUMN_ID, ROLE)
		values
			 (61, 'MEASURE'), (61, 'AXIS'), (61, 'FILTER'),
			 (62, 'MEASURE'), (62, 'AXIS'), (62, 'FILTER'),
			 (63, 'MEASURE'), (63, 'AXIS'), (63, 'FILTER'),
			 (64, 'MEASURE'), (64, 'AXIS'), (64, 'FILTER'),
			 (65, 'MEASURE'), (65, 'AXIS'), (65, 'FILTER');
		
		
		
		
		-- columns for entity : EXECUTION --
		
		insert into CHART_COLUMN_PROTOTYPE(CHART_COLUMN_ID, COLUMN_TYPE, BUSINESS, LABEL, ENTITY_TYPE, ENTITY_ROLE, DATA_TYPE, ATTRIBUTE_NAME, SUBQUERY_ID)
		values
			(72, 'CALCULATED', TRUE, 'EXECUTION_ISAUTO', 'EXECUTION', null, 'BOOLEAN', 'notnull(automatedExecutionExtender)', 20),
			(73, 'CALCULATED', TRUE, 'EXECUTION_ISSUECOUNT', 'EXECUTION', null, 'NUMERIC', 'count(issues)', 21);
		
		insert into CHART_COLUMN_ROLE(CHART_COLUMN_ID, ROLE)
		values
			 (72, 'FILTER'),
			 (73, 'MEASURE'), (73, 'AXIS'), (73, 'FILTER');

		</sql>

	</changeSet>

 <changeSet id="tm-1.13.0-feature-5292-1" author="jthebault">
 	<!-- CUSTOM_REPORT_LIBRARY TABLE -->

 	<createTable tableName="CUSTOM_REPORT_LIBRARY">
 		<column name="CRL_ID" type="BIGINT" autoIncrement="true" remarks="pk genere">
        	<constraints primaryKey="true" nullable="false" primaryKeyName="PK_CUSTOM_REPORT_LIBRARY" />
    	</column>

		<column name="ATTACHMENT_LIST_ID" type="BIGINT" remarks="FK to ATTACHMENT_LIST">
		</column>

 	</createTable>

 	<createIndex tableName="CUSTOM_REPORT_LIBRARY" indexName="IDX_CUSTOM_REPORT_LIBRARY">
      <column name="CRL_ID" />
    </createIndex>

 	<!-- CUSTOM_REPORT_LIBRARY_NODE TABLE -->

 	<createTable tableName="CUSTOM_REPORT_LIBRARY_NODE">
 		<column name="CRLN_ID" type="BIGINT" autoIncrement="true" remarks="pk genere">
      <constraints primaryKey="true" nullable="false" primaryKeyName="PK_CUSTOM_REPORT_LIBRARY_NODE" />
    </column>

		<column name="NAME" type="VARCHAR(255)"/>

		<column name="ENTITY_TYPE" type="VARCHAR(50)"/>

		<column name="ENTITY_ID" type="BIGINT"/>

		<column name="CRL_ID" type="BIGINT" remarks="fk to the containing CUSTOM_REPORT_LIBRARY">
			<constraints nullable="true" foreignKeyName="fk_crln_custom_report_library_crl_id" references="CUSTOM_REPORT_LIBRARY(CRL_ID)" />
		</column>

	</createTable>


	<!-- CUSTOM_REPORT_LIBRARY_NODE Relationship -->

	<comment>This table contains the relations between two custom reports nodes. If a node is root, parent id will be null and descendant id will be itself.
		a given node can be referenced as descendant only one time so we can map the join with hibernate</comment>
	<createTable tableName="CRLN_RELATIONSHIP">

		<column name="ANCESTOR_ID" type="BIGINT" remarks="cle etrangere vers le noeud parent">
			<constraints nullable="true" foreignKeyName="fk_crln_relationship_ancestor" references="CUSTOM_REPORT_LIBRARY_NODE(CRLN_ID)" />
		</column>

		<column name="DESCENDANT_ID" type="BIGINT" remarks="cle etrangere vers l'element fils. ">
			<constraints nullable="false" foreignKeyName="fk_crln_relationship_descendant" references="CUSTOM_REPORT_LIBRARY_NODE(CRLN_ID)" />
		</column>

		<column name="CONTENT_ORDER" type="BIGINT" remarks="numéro d'ordre du noeud dans son parent">
		</column>
	</createTable>

	<createIndex tableName="CRLN_RELATIONSHIP" indexName="idx_crln_relationship_descendant">
		<column name="DESCENDANT_ID" />
	</createIndex>

	<createIndex tableName="CRLN_RELATIONSHIP" indexName="idx_crln_relationship_ancestor">
		<column name="ANCESTOR_ID" />
	</createIndex>

	<createTable tableName="CUSTOM_REPORT_FOLDER">
		<column name="CRF_ID" type="BIGINT" autoIncrement="true" remarks="pk genere">
			<constraints primaryKey="true" nullable="false" primaryKeyName="PK_CRF_ID" />
		</column>

		<column name="NAME" type="VARCHAR(255)"/>

		<column name="DESCRIPTION" type="CLOB"/>

		<column name="PROJECT_ID" type="BIGINT" remarks="cle etrangere vers le projet. ">
			<constraints nullable="false" foreignKeyName="fk_project_custom_report_folder_project_id" references="PROJECT(PROJECT_ID)" />
		</column>

	</createTable>

	<createTable tableName="CUSTOM_REPORT_DASHBOARD">
		<column name="CRD_ID" type="BIGINT" autoIncrement="true" remarks="pk genere">
			<constraints primaryKey="true" nullable="false" primaryKeyName="PK_CRD_ID" />
		</column>

		<column name="NAME" type="VARCHAR(255)"/>

		<column name="PROJECT_ID" type="BIGINT" remarks="cle etrangere vers le projet. ">
			<constraints nullable="false" foreignKeyName="fk_project_custom_report_dashboard_project_id" references="PROJECT(PROJECT_ID)" />
		</column>

    <column name="CREATED_BY" type="java.sql.Types.VARCHAR(50)">
      <constraints nullable="false" />
    </column>

    <column name="CREATED_ON" type="DATETIME">
      <constraints nullable="false" />
    </column>

    <column name="LAST_MODIFIED_BY" type="java.sql.Types.VARCHAR(50)" defaultValue="NULL" />
    <column name="LAST_MODIFIED_ON" type="DATETIME" defaultValue="NULL" />

	</createTable>

	<createTable tableName="CUSTOM_REPORT_CHART_BINDING">
		<column name="CRCB_ID" type="BIGINT" autoIncrement="true" remarks="pk genere">
			<constraints primaryKey="true" nullable="false" primaryKeyName="PK_CRCB_ID" />
		</column>

		<column name="CRD_ID" type="BIGINT" remarks="cle etrangere vers le dashboard. ">
			<constraints nullable="false" foreignKeyName="fk_chart_bindind_custom_report_dashboard_crd_id" references="CUSTOM_REPORT_DASHBOARD(CRD_ID)" />
		</column>

		<column name="CHART_ID" type="BIGINT" remarks="cle etrangere vers le chart. ">
			<constraints nullable="false" foreignKeyName="fk_chart_bindind_chart_definition_chart_id" references="CHART_DEFINITION(CHART_ID)" />
		</column>

		<column name="ROW" type="INT"/>

		<column name="COL" type="INT"/>

		<column name="SIZE_X" type="INT"/>

		<column name="SIZE_Y" type="INT"/>

	</createTable>

	<addColumn tableName="PROJECT">
 		<column name="CRL_ID" type="BIGINT" remarks="FK FOR CUSTOM_REPORT_LIBRARY.CRL_ID">
      	</column>
 	</addColumn>

 	<addColumn tableName="ATTACHMENT_LIST">
 		<column name="TMP_CRL_ID" type="BIGINT" remarks="TMP FK FOR CUSTOM_REPORT_LIBRARY.CRL_ID">
      	</column>
 	</addColumn>


	<!-- CLOSURE -->
	<comment>
		closure table for custom report library nodes. Its content is set and modified by four triggers
	</comment>

	<createTable tableName="CRLN_RELATIONSHIP_CLOSURE">

		<column name="ANCESTOR_ID" type="BIGINT"
			remarks="cle etrangere vers le noeud parent. La relation est parfois d'un noeud vers lui meme.">
			<constraints nullable="false" foreignKeyName="fk_crln_relationship_clos_anc"
				references="CUSTOM_REPORT_LIBRARY_NODE(CRLN_ID)" />
		</column>

		<column name="DESCENDANT_ID" type="BIGINT"
			remarks="cle etrangere vers l'element fils. La relation est parfois d'un noeud vers lui meme.">
			<constraints nullable="false" foreignKeyName="fk_crln_relationship_clos_desc"
				references="CUSTOM_REPORT_LIBRARY_NODE(CRLN_ID)" />
		</column>


		<column name="DEPTH" type="SMALLINT"
			remarks="stores how deep is the descendant element nested in the subtree of the ancestor element">
			<constraints nullable="false" />
		</column>
	</createTable>


	<createIndex tableName="CRLN_RELATIONSHIP_CLOSURE"
		indexName="idx_crln_relationship_clos_desc">
		<column name="DESCENDANT_ID" />
	</createIndex>

	<createIndex tableName="CRLN_RELATIONSHIP_CLOSURE"
		indexName="idx_crln_relationship_clos_anc">
		<column name="ANCESTOR_ID" />
	</createIndex>
	
	<addUniqueConstraint tableName="CRLN_RELATIONSHIP_CLOSURE" columnNames="ANCESTOR_ID, DESCENDANT_ID"/>


	<!-- CLOSURE-->


	<insert tableName="ACL_CLASS">
		<column name="CLASSNAME" value="org.squashtest.tm.domain.customreport.CustomReportLibrary" />
	</insert>

	<!-- PROJECT MANAGER -->

	<insert tableName="ACL_GROUP_PERMISSION">
		<column name="ACL_GROUP_ID" valueComputed="(select ID from ACL_GROUP where QUALIFIED_NAME = 'squashtest.acl.group.tm.ProjectManager')" />
		<column name="PERMISSION_MASK" value="1" />
		<column name="CLASS_ID" valueComputed="(select ID from ACL_CLASS where CLASSNAME = 'org.squashtest.tm.domain.customreport.CustomReportLibrary')" />
	</insert>

	<insert tableName="ACL_GROUP_PERMISSION">
		<column name="ACL_GROUP_ID" valueComputed="(select ID from ACL_GROUP where QUALIFIED_NAME = 'squashtest.acl.group.tm.ProjectManager')" />
		<column name="PERMISSION_MASK" value="2" />
		<column name="CLASS_ID" valueComputed="(select ID from ACL_CLASS where CLASSNAME = 'org.squashtest.tm.domain.customreport.CustomReportLibrary')" />
	</insert>

	<insert tableName="ACL_GROUP_PERMISSION">
		<column name="ACL_GROUP_ID" valueComputed="(select ID from ACL_GROUP where QUALIFIED_NAME = 'squashtest.acl.group.tm.ProjectManager')" />
		<column name="PERMISSION_MASK" value="4" />
		<column name="CLASS_ID" valueComputed="(select ID from ACL_CLASS where CLASSNAME = 'org.squashtest.tm.domain.customreport.CustomReportLibrary')" />
	</insert>

	<insert tableName="ACL_GROUP_PERMISSION">
		<column name="ACL_GROUP_ID" valueComputed="(select ID from ACL_GROUP where QUALIFIED_NAME = 'squashtest.acl.group.tm.ProjectManager')" />
		<column name="PERMISSION_MASK" value="8" />
		<column name="CLASS_ID" valueComputed="(select ID from ACL_CLASS where CLASSNAME = 'org.squashtest.tm.domain.customreport.CustomReportLibrary')" />
	</insert>

	<insert tableName="ACL_GROUP_PERMISSION">
		<column name="ACL_GROUP_ID" valueComputed="(select ID from ACL_GROUP where QUALIFIED_NAME = 'squashtest.acl.group.tm.ProjectManager')" />
		<column name="PERMISSION_MASK" value="1024" />
		<column name="CLASS_ID" valueComputed="(select ID from ACL_CLASS where CLASSNAME = 'org.squashtest.tm.domain.customreport.CustomReportLibrary')" />
	</insert>

<!-- /PROJECT MANAGER -->

<!-- TEST EDITOR (Testeur Référent) -->

<insert tableName="ACL_GROUP_PERMISSION">
	<column name="ACL_GROUP_ID" valueComputed="(select ID from ACL_GROUP where QUALIFIED_NAME = 'squashtest.acl.group.tm.TestEditor')" />
	<column name="PERMISSION_MASK" value="1" />
	<column name="CLASS_ID" valueComputed="(select ID from ACL_CLASS where CLASSNAME = 'org.squashtest.tm.domain.customreport.CustomReportLibrary')" />
</insert>

<insert tableName="ACL_GROUP_PERMISSION">
	<column name="ACL_GROUP_ID" valueComputed="(select ID from ACL_GROUP where QUALIFIED_NAME = 'squashtest.acl.group.tm.TestEditor')" />
	<column name="PERMISSION_MASK" value="2" />
	<column name="CLASS_ID" valueComputed="(select ID from ACL_CLASS where CLASSNAME = 'org.squashtest.tm.domain.customreport.CustomReportLibrary')" />
</insert>

<insert tableName="ACL_GROUP_PERMISSION">
	<column name="ACL_GROUP_ID" valueComputed="(select ID from ACL_GROUP where QUALIFIED_NAME = 'squashtest.acl.group.tm.TestEditor')" />
	<column name="PERMISSION_MASK" value="4" />
	<column name="CLASS_ID" valueComputed="(select ID from ACL_CLASS where CLASSNAME = 'org.squashtest.tm.domain.customreport.CustomReportLibrary')" />
</insert>

<insert tableName="ACL_GROUP_PERMISSION">
	<column name="ACL_GROUP_ID" valueComputed="(select ID from ACL_GROUP where QUALIFIED_NAME = 'squashtest.acl.group.tm.TestEditor')" />
	<column name="PERMISSION_MASK" value="8" />
	<column name="CLASS_ID" valueComputed="(select ID from ACL_CLASS where CLASSNAME = 'org.squashtest.tm.domain.customreport.CustomReportLibrary')" />
</insert>

<insert tableName="ACL_GROUP_PERMISSION">
	<column name="ACL_GROUP_ID" valueComputed="(select ID from ACL_GROUP where QUALIFIED_NAME = 'squashtest.acl.group.tm.TestEditor')" />
	<column name="PERMISSION_MASK" value="1024" />
	<column name="CLASS_ID" valueComputed="(select ID from ACL_CLASS where CLASSNAME = 'org.squashtest.tm.domain.customreport.CustomReportLibrary')" />
</insert>

<!-- /TEST EDITOR -->
<!-- ALL OTHER PROFILES READ ONLY -->

<insert tableName="ACL_GROUP_PERMISSION">
	<column name="ACL_GROUP_ID" valueComputed="(select ID from ACL_GROUP where QUALIFIED_NAME = 'squashtest.acl.group.tm.ProjectViewer')" />
	<column name="PERMISSION_MASK" value="1" />
	<column name="CLASS_ID" valueComputed="(select ID from ACL_CLASS where CLASSNAME = 'org.squashtest.tm.domain.customreport.CustomReportLibrary')" />
</insert>

<insert tableName="ACL_GROUP_PERMISSION">
	<column name="ACL_GROUP_ID" valueComputed="(select ID from ACL_GROUP where QUALIFIED_NAME = 'squashtest.acl.group.tm.TestRunner')" />
	<column name="PERMISSION_MASK" value="1" />
	<column name="CLASS_ID" valueComputed="(select ID from ACL_CLASS where CLASSNAME = 'org.squashtest.tm.domain.customreport.CustomReportLibrary')" />
</insert>

<insert tableName="ACL_GROUP_PERMISSION">
	<column name="ACL_GROUP_ID" valueComputed="(select ID from ACL_GROUP where QUALIFIED_NAME = 'squashtest.acl.group.tm.TestDesigner')" />
	<column name="PERMISSION_MASK" value="1" />
	<column name="CLASS_ID" valueComputed="(select ID from ACL_CLASS where CLASSNAME = 'org.squashtest.tm.domain.customreport.CustomReportLibrary')" />
</insert>

<insert tableName="ACL_GROUP_PERMISSION">
	<column name="ACL_GROUP_ID" valueComputed="(select ID from ACL_GROUP where QUALIFIED_NAME = 'squashtest.acl.group.tm.AdvanceTester')" />
	<column name="PERMISSION_MASK" value="1" />
	<column name="CLASS_ID" valueComputed="(select ID from ACL_CLASS where CLASSNAME = 'org.squashtest.tm.domain.customreport.CustomReportLibrary')" />
</insert>

<insert tableName="ACL_GROUP_PERMISSION">
	<column name="ACL_GROUP_ID" valueComputed="(select ID from ACL_GROUP where QUALIFIED_NAME = 'squashtest.acl.group.tm.Validator')" />
	<column name="PERMISSION_MASK" value="1" />
	<column name="CLASS_ID" valueComputed="(select ID from ACL_CLASS where CLASSNAME = 'org.squashtest.tm.domain.customreport.CustomReportLibrary')" />
</insert>

</changeSet>

<changeSet id="tm-1.13.0-feat-5292-2-postgresql" author="jthebault"
	dbms="postgresql">
	<comment>postgresql-triggers for CRLN_RELATIONSHIP_CLOSURE table</comment>

	<!-- after insertion of a cl node : create auto reference in the closure table -->
	<createProcedure>
		drop trigger if exists ins_crln_after on CUSTOM_REPORT_LIBRARY_NODE;
		drop function if exists ins_crln_after();
		create function ins_crln_after() returns trigger as $ins_crln_after$
		begin
			insert into CRLN_RELATIONSHIP_CLOSURE
			values (new.crln_id, new.crln_id, 0);
			return new;
		end;
		$ins_crln_after$ language plpgsql;

		create trigger ins_crln_after after insert on CUSTOM_REPORT_LIBRARY_NODE
		for each row execute procedure ins_crln_after();

	</createProcedure>



	<!-- before suppression of a cl node : remove auto reference from the closure table -->
	<createProcedure>
		drop trigger if exists del_crln_before on CUSTOM_REPORT_LIBRARY_NODE;
		drop function if exists del_crln_before();
		create function del_crln_before() returns trigger as $del_crln_before$
		begin
			delete from CRLN_RELATIONSHIP_CLOSURE
			where ancestor_id = old.crln_id
			and descendant_id = old.crln_id;
			return old;
		end;
		$del_crln_before$ language plpgsql;

		create trigger del_crln_before before delete on CUSTOM_REPORT_LIBRARY_NODE
		for each row execute procedure del_crln_before();

	</createProcedure>


	<!-- when two rl nodes are attached : attach the subtrees as well. -->
	<createProcedure>
		drop trigger if exists attach_crln_after on CRLN_RELATIONSHIP;
		drop function if exists attach_crln_after();
		create function attach_crln_after() returns trigger as $attach_crln_after$
		begin
			insert into CRLN_RELATIONSHIP_CLOSURE
			select c1.ancestor_id, c2.descendant_id, c1.depth + c2.depth + 1
			from CRLN_RELATIONSHIP_CLOSURE c1
			cross join CRLN_RELATIONSHIP_CLOSURE c2
			where c1.descendant_id = new.ancestor_id
			and c2.ancestor_id = new.descendant_id;
			return new;
		end;
		$attach_crln_after$ language plpgsql;

		create trigger attach_crln_after after insert on CRLN_RELATIONSHIP
		for each row execute procedure attach_crln_after();

	</createProcedure>


	<!-- when two cl nodes are detached : detach the subtrees as well -->
	<createProcedure>
		drop trigger if exists detach_crln_before on CRLN_RELATIONSHIP;
		drop function if exists detach_crln_before();
		create function detach_crln_before() returns trigger as $detach_crln_before$
		begin
			delete from CRLN_RELATIONSHIP_CLOSURE
			where descendant_id in ( select descendant_id from CRLN_RELATIONSHIP_CLOSURE where ancestor_id = old.descendant_id )
			and ancestor_id not in ( select descendant_id from CRLN_RELATIONSHIP_CLOSURE where ancestor_id = old.descendant_id )
			;
			return old;
		end;
		$detach_crln_before$ language plpgsql;

		create trigger detach_crln_before before delete on CRLN_RELATIONSHIP
		for each row execute procedure detach_crln_before();

	</createProcedure>
</changeSet>

<changeSet id="tm-1.13.0-feat-5292-2-h2" author="jthebault" dbms="h2">

	<comment>h2-triggers for CRLN_RELATIONSHIP_CLOSURE table</comment>

	<!-- after insertion of a cl node : create auto reference in the closure
		table -->
	<sql>
		create trigger ins_crln_after after insert on
		CUSTOM_REPORT_LIBRARY_NODE
		for each row call
		"org.squashtest.csp.h2.triggers.CRLNAfterInsert";
	</sql>



	<!-- before suppression of a cl node : remove auto reference from the closure
		table -->
	<sql>
		create trigger del_crln_before before delete on
		CUSTOM_REPORT_LIBRARY_NODE
		for each row call
		"org.squashtest.csp.h2.triggers.CRLNBeforeDelete";
	</sql>


	<!-- when two cl nodes are attached : attach the subtrees as well. -->
	<sql>
		create trigger attach_crln_after after insert on CRLN_RELATIONSHIP
		for each row call "org.squashtest.csp.h2.triggers.CRLNAfterAttach";
	</sql>


	<!-- when two cl nodes are detached : detach the subtrees as well -->
	<sql>
		create trigger detach_crln_before before delete on
		CRLN_RELATIONSHIP
		for each row call
		"org.squashtest.csp.h2.triggers.CRLNBeforeDetach";
	</sql>

</changeSet>

<!-- ************** /h2 triggers **************** -->

<changeSet id="tm-1.13.0-feat-5292-2-mysql" author="jthebault"
	dbms="mysql">
	<comment>mysql-triggers for CRLN_RELATIONSHIP_CLOSURE table</comment>

	<!-- after insertion of a crl node : create auto reference in the closure
		table -->
	<sql>
		create trigger ins_crln_after after insert on
		CUSTOM_REPORT_LIBRARY_NODE
		for each row insert ignore into
		CRLN_RELATIONSHIP_CLOSURE values (new.crln_id, new.crln_id, 0);
	</sql>



	<!-- before suppression of a cl node : remove auto reference from the closure
		table -->
	<sql>
		create trigger del_crln_before before delete on
		CUSTOM_REPORT_LIBRARY_NODE
		for each row delete from
		CRLN_RELATIONSHIP_CLOSURE where ancestor_id=old.crln_id and
		descendant_id=old.crln_id;
	</sql>


	<!-- when two rl nodes are attached : attach the subtrees as well. -->
	<sql>
		create trigger attach_crln_after after insert on CRLN_RELATIONSHIP
		for each row insert ignore into CRLN_RELATIONSHIP_CLOSURE
		select
		c1.ancestor_id, c2.descendant_id, c1.depth+c2.depth+1
		from
		CRLN_RELATIONSHIP_CLOSURE c1
		cross join CRLN_RELATIONSHIP_CLOSURE c2
		where c1.descendant_id = new.ancestor_id
		and c2.ancestor_id = new.descendant_id;
	</sql>


	<!-- when two cl nodes are detached : detach the subtrees as well -->
	<sql>
		create trigger detach_crln_before before delete on
		CRLN_RELATIONSHIP
		for each row delete clos1 from
		CRLN_RELATIONSHIP_CLOSURE clos1
		join CRLN_RELATIONSHIP_CLOSURE clos2
		on
		clos1.descendant_id=clos2.descendant_id
		left join
		CRLN_RELATIONSHIP_CLOSURE clos3
		on clos3.ancestor_id = clos2.ancestor_id
		and clos3.descendant_id = clos1.ancestor_id
		where
		clos2.ancestor_id = old.descendant_id
		and clos3.ancestor_id is null;
	</sql>
</changeSet>

<changeSet id="tm-1.13.0-feat-5292-3" author="jthebault">
<comment>Migration for custom report workspace evolution. Mainly create the Library entities and their nodes, attachement list...</comment>

<!-- SQL CREATE A NEW CUSTOM_REPORT_LIBRARY FOR EACH PROJECT IN DB AND CREATE ACLS ON OBJECT-->

<!-- Note : we force CRLN_ID = PROJECT_ID. 
Although not technically needed, this is more aesthetic and convenient. 
-->
<sql>
	insert into CUSTOM_REPORT_LIBRARY (CRL_ID)
		select p.PROJECT_ID
		from PROJECT p;

	update PROJECT p
		set CRL_ID = PROJECT_ID;

	insert into ACL_OBJECT_IDENTITY (IDENTITY,CLASS_ID)
		  select CRL_ID, ID from CUSTOM_REPORT_LIBRARY,ACL_CLASS
		  where ACL_CLASS.CLASSNAME LIKE 'org.squashtest.tm.domain.customreport.CustomReportLibrary';
</sql>



<!-- SQL CREATE A NEW ATTACHEMENT_LIST FOR EACH PREVIOUSLY CUSTOM_REPORT_LIBRARY IN DB -->
<sql>
	insert into ATTACHMENT_LIST (TMP_CRL_ID)
		select CRL_ID
		from CUSTOM_REPORT_LIBRARY crl;

	update CUSTOM_REPORT_LIBRARY crl
		set ATTACHMENT_LIST_ID = (
			select ATTACHMENT_LIST_ID
			from ATTACHMENT_LIST al
			where crl.CRL_ID = al.TMP_CRL_ID
	);

</sql>
<sql>

	insert into CUSTOM_REPORT_LIBRARY_NODE (ENTITY_ID,CRL_ID,ENTITY_TYPE)
		select CRL_ID,CRL_ID,'LIBRARY'
		from CUSTOM_REPORT_LIBRARY;

</sql>
<sql>

	update CUSTOM_REPORT_LIBRARY_NODE
		set NAME = (
				select p.NAME
				from PROJECT p
				where ENTITY_ID = p.CRL_ID
			)
		where ENTITY_TYPE = 'LIBRARY';

</sql>


<!-- REMOVE TMP COLUMNS USED FOR MIGRATION -->
<dropColumn tableName="ATTACHMENT_LIST" columnName="TMP_CRL_ID" />

</changeSet>

<changeSet id="tm-1.13.0-feature-5292-4" author="bsiri" >
   <comment>set the foreign key constraints from project to custom report library, and from custom report_library to attachment_list</comment>
   
   <addForeignKeyConstraint constraintName="fk_project_crl" baseTableName="PROJECT"
      baseColumnNames="CRL_ID" referencedTableName="CUSTOM_REPORT_LIBRARY" referencedColumnNames="CRL_ID" />
      
   <addForeignKeyConstraint constraintName="fk_crl_attachment_list" baseTableName="CUSTOM_REPORT_LIBRARY"
      baseColumnNames="ATTACHMENT_LIST_ID" referencedTableName="ATTACHMENT_LIST" referencedColumnNames="ATTACHMENT_LIST_ID" />      
 </changeSet>


  <changeSet id="tm-1.13.0-feature-5292-5" author="jthebault" dbms="postgresql">
     <comment>update the sequences afterward</comment>
     <sql>
       SELECT setval('custom_report_library_crl_id_seq', (SELECT MAX(CRL_ID) from CUSTOM_REPORT_LIBRARY));
       SELECT setval('custom_report_library_node_crln_id_seq', (SELECT MAX(CRLN_ID) from CUSTOM_REPORT_LIBRARY_NODE));
       SELECT setval('acl_object_identity_id_seq', (SELECT MAX(ID) from ACL_OBJECT_IDENTITY));
     </sql>
   </changeSet>
   
<!-- 
	DEACTIVATING MIGRATION, AS CHARTS ON CUFS ARE NOW OUT OF SCOPE OF 1.13
	RE-ACTIVATE WHEN DEV 1.14 BEGINS
 -->
<!--  
<changeSet id="tm-1.13.0.feat-5493" author="jsimon">

<sql>
INSERT INTO CHART_COLUMN_PROTOTYPE (COLUMN_TYPE, LABEL, ENTITY_TYPE,  ATTRIBUTE_NAME, DATA_TYPE, BUSINESS, ATTRIBUTE_TYPE)
SELECT 'CUF', concat(bound_entity, '_CUF_', code), bound_entity,  code, 'STRING', true,'ATTRIBUTE'
FROM (SELECT DISTINCT bound_entity, code FROM CUSTOM_FIELD_BINDING cfb join CUSTOM_FIELD cf ON cfb.cf_id= cf.cf_id WHERE cf.INPUT_TYPE = 'PLAIN_TEXT' ) as request;

INSERT INTO CHART_COLUMN_PROTOTYPE (COLUMN_TYPE, LABEL, ENTITY_TYPE,  ATTRIBUTE_NAME, DATA_TYPE, BUSINESS, ATTRIBUTE_TYPE)
SELECT 'CUF', concat(bound_entity, '_CUF_', code), bound_entity, code, 'STRING', true,'ATTRIBUTE'
FROM (SELECT DISTINCT bound_entity, code FROM CUSTOM_FIELD_BINDING cfb join CUSTOM_FIELD cf ON cfb.cf_id= cf.cf_id WHERE cf.INPUT_TYPE = 'RICH_TEXT' ) as request;

INSERT INTO CHART_COLUMN_PROTOTYPE (COLUMN_TYPE, LABEL, ENTITY_TYPE,  ATTRIBUTE_NAME, DATA_TYPE, BUSINESS, ATTRIBUTE_TYPE)
SELECT 'CUF', concat(bound_entity, '_CUF_', code), bound_entity, code, 'DATE', true,'ATTRIBUTE'
FROM (SELECT DISTINCT bound_entity, code FROM CUSTOM_FIELD_BINDING cfb join CUSTOM_FIELD cf ON cfb.cf_id= cf.cf_id WHERE cf.INPUT_TYPE = 'DATE_PICKER' ) as request;

INSERT INTO CHART_COLUMN_PROTOTYPE (COLUMN_TYPE, LABEL, ENTITY_TYPE,  ATTRIBUTE_NAME, DATA_TYPE, BUSINESS, ATTRIBUTE_TYPE)
SELECT 'CUF', concat(bound_entity, '_CUF_', code), bound_entity, code, 'LIST', true,'ATTRIBUTE'
FROM (SELECT DISTINCT bound_entity, code FROM CUSTOM_FIELD_BINDING cfb join CUSTOM_FIELD cf ON cfb.cf_id= cf.cf_id WHERE cf.INPUT_TYPE = 'DROPDOWN_LIST' ) as request;

INSERT INTO CHART_COLUMN_PROTOTYPE (COLUMN_TYPE, LABEL, ENTITY_TYPE,  ATTRIBUTE_NAME, DATA_TYPE, BUSINESS, ATTRIBUTE_TYPE)
SELECT 'CUF', concat(bound_entity, '_CUF_', code), bound_entity, code, 'EXISTENCE', true,'ATTRIBUTE'
FROM (SELECT DISTINCT bound_entity, code FROM CUSTOM_FIELD_BINDING cfb join CUSTOM_FIELD cf ON cfb.cf_id= cf.cf_id WHERE cf.INPUT_TYPE = 'CHECKBOX' ) as request;

INSERT INTO CHART_COLUMN_ROLE(CHART_COLUMN_ID, ROLE)
SELECT CHART_COLUMN_ID, 'FILTER' FROM CHART_COLUMN_PROTOTYPE ccp WHERE ccp.COLUMN_TYPE = 'CUF';


</sql>
</changeSet>
-->

<changeSet id="tm-1.13.0-feature-5375-3" author="jsimon, bsiri" dbms="postgresql">
   <comment>update the sequences afterward</comment>
   <sql>
     SELECT setval('chart_column_prototype_chart_column_id_seq', (SELECT MAX(CHART_COLUMN_ID) from CHART_COLUMN_PROTOTYPE));
     SELECT setval('chart_query_chart_query_id_seq', (SELECT MAX(CHART_QUERY_ID) from CHART_QUERY));
     SELECT setval('chart_filter_filter_id_seq', (SELECT MAX(FILTER_ID) from CHART_FILTER));
   </sql>
 </changeSet>
 

<changeSet id="tm-1.13.0-feature-5375-4" author="jsimon">

<comment>

</comment>

	<createTable tableName="CHART_PROJECT_SCOPE">
			<column name="CHART_PROJECT_SCOPE_ID" type="BIGINT"
				autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="CHART_ID" type="BIGINT">
				<constraints nullable="false"
					foreignKeyName="fk_chart_project_scope_chart_definition"
					references="CHART_DEFINITION(CHART_ID)" />
			</column>

			<column name="PROJECT_SCOPE" type="java.sql.Types.VARCHAR(15)"></column>

		</createTable>
</changeSet>


	<changeSet id="tm-1.13.0-feature-5265-1" author="bsiri">

	<comment>
	This table holds the optional extension for requirement, that flags them as synchronized requirement
	</comment>

		<createTable tableName="REQUIREMENT_SYNC_EXTENDER">
			<column name="REQ_SYNC_ID" type="BIGINT"
				autoIncrement="true" remarks="autogenerated key">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="REQUIREMENT_ID" type="BIGINT" remarks="foreign key to the (now synchronized) requirement">
				<constraints nullable="false"
					foreignKeyName="fk_sync_extender_requirement"
					references="REQUIREMENT(RLN_ID)" />
			</column>

			<column name="BUGTRACKER_ID" type="BIGINT" remarks="foreign key to the source bugtracker">
				<constraints nullable="false"
					foreignKeyName="fk_sync_extender_bugtracker"
					references="BUGTRACKER(BUGTRACKER_ID)" />
			</column>

			<column name="REMOTE_REQ_ID" type="java.sql.Types.VARCHAR(15)" remarks="ID of the remote requirement"/>

			<column name="REMOTE_PROJECT_ID" type="java.sql.Types.VARCHAR(15)" remarks="ID of the remote project that hosts the remote requirement"/>

			<column name="REMOTE_REQ_URL" type="VARCHAR(300)" remarks="the url of the remote requirement" />

     		<column name="LAST_SYNCHRONIZED_BY" type="java.sql.Types.VARCHAR(50)" defaultValue="NULL"
        remarks="the last used that synchronized that requirement with the remote manager" />


		</createTable>
	</changeSet>

	<changeSet id="tm-1.13.0-feature-5265-2" author="bsiri">

	<comment>
		adding a column recording how a requirement should be managed
	</comment>

	<addColumn tableName="REQUIREMENT">
		<column name="MODE" type="VARCHAR(15)" defaultValue="NATIVE" remarks="Says whether a requirement is NATIVE or SYNCHRONIZED"/>
	</addColumn>

	</changeSet>


</databaseChangeLog>
